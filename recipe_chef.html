<!DOCTYPE html>
<html lang="en">

<head>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="recipe chef - takes recipe name, its
										its classification and details">
	<meta name="author" content="pcmquizon">

	<title>Recipe Chef</title>

	<!--
	<script src="https://cdn.firebase.com/js/client/2.2.1/firebase.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	-->

	<script src="js/recipes.js"></script>
	<script type="text/javascript"> 
		var currentPageCount = 0; 
		var recipeList = new Array(); 
		var recipePerPage = 5;
		var activePage = 1;
		var recipeDisplayed = 0;
	</script>

	<!-- Bootstrap Core CSS -->
	<link href="css/bootstrap.css" rel="stylesheet">
	<link href="css/bootstrap.min.css" rel="stylesheet">

	<!-- Custom CSS -->
	<link href="css/simple-sidebar.css" rel="stylesheet">
	<link href="css/pinBoot.css" rel="stylesheet">
	<link href='css/fonts.css' rel='stylesheet' type='text/css'>

	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn"t work if you view the page via file:// -->
	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
		<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
	<![endif]-->

	<style type="text/css">
		@media (max-width:768px){
			#sidebar-wrapper > *, #menu-toggle {
				visibility: hidden;
			}

			#page-content-wrapper {
				padding-top: 0px;
			}

		}
	</style>
</head>

<body>

	<div id="wrapper">

		<!-- Fixed navbar, visible only in small screens -->
		<nav class="navbar navbar-default navbar-static-top visible-xs">
			<div class="container">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>

					<a class="navbar-brand" href="#">Recipe Chef</a>
				</div>
				<div id="navbar" class="navbar-collapse collapse in">
					<ul class="nav navbar-nav">
						<li style="padding: 10px;">
							<label>Name:</label>
							<input type="text" class = "form-group form-control recipeNameInput" placeholder="What is the recipe called?">
							
							<label>Classification:</label>
							<input type="text" class = "form-group form-control recipeClassificationInput" placeholder="Mexican, Asian, French, etc.,"/>
							
							<label>Details:</label>
							<textarea style="max-width:100%; min-height: 140px; max-height: 245px;" class = "form-group form-control recipeDetailsInput" placeholder="What are the ingredients? How to prepare?"></textarea>
							<button class = "btn btn-primary" id="addFromNavBar">Add Recipe</button>	
						</li>					
					</ul>
				</div><!--/.nav-collapse -->
			</div>
		</nav>

		<!-- Sidebar, visible desktops and large screens -->
		<div id="sidebar-wrapper" class="visible-sm visible-md visible-lg">
			<ul class="sidebar-nav" id="sidebar">
				<li class="sidebar-brand">				
					<a class="sidebar-brand" href="#" class="active">Recipe Chef</a>
				</li>
				
				<li style="padding: 10px;">
						
					<label>Name:</label>
					<input type="text" class = "form-group form-control recipeNameInput" placeholder="What is the recipe called?">

					<label>Classification:</label>
					<input type="text" class = "form-group form-control recipeClassificationInput" placeholder="Mexican, Asian, French, etc.,"/>

					<label>Details:</label>
					<textarea style="max-width:100%; min-height: 150px; max-height: 245px;" class = "form-group form-control recipeDetailsInput" placeholder="What are the ingredients? How to prepare?"></textarea>
					<button class = "btn btn-primary" id="addFromSideBar">Add recipe</button>	
				</li>					
				
			</ul>
		</div>
		<!-- /#sidebar-wrapper -->

		
			<!-- Page Content -->
			<!-- Make sure to keep all page content within the #page-content-wrapper -->
			<div id="page-content-wrapper">
				<a href="#menu-toggle" class="btn btn-lg btn-default btn-group" id="menu-toggle" >
					<span class="glyphicon glyphicon-menu-hamburger"></span>
				</a>
				<h1 id="page-brand" class="toggled" style="display: inline; vertical-align: middle; padding-left: 10px;">Recipe Chef</h1>
				<div class="container-fluid">
					
					<div class="row">	
					<!-- Recipes go here -->
						<section class="col-lg-12" id="recipesDiv" style="margin-top: 13px;"></section>
					</div>
					
					<!-- Pagination go here -->
					<div id="pages"></div>


				</div>
			</div>
			<!-- /#page-content-wrapper -->	
		
		

	</div>
	<!-- /#wrapper -->


	<!-- jQuery -->
	<script src="js/jquery.min.js"></script>

	<!-- Firebase -->
	<script src="js/firebase.js"></script>

	<!-- Bootstrap Core JavaScript -->
	<script src="js/bootstrap.min.js"></script>

	<script src="js/pinBoot.js"></script>

	<!-- Menu Toggle Script -->
	<script>
	$("#menu-toggle").click(function(e) {
		e.preventDefault();
		$("#wrapper").toggleClass("toggled");
		$("#page-brand").toggleClass("toggled");
		console.log("toggled");
	
		/*
			$("<h1/>")
				.css({"display": "inline",
						"vertical-align": "middle",
						"padding-left": "10px"
				})
				.html("Recipe Chef")
				.insertAfter("#menu-toggle");
			});
		*/
	});
	</script>

	<script>
		var myDataRef = new Firebase("https://glowing-fire-7258.firebaseio.com/");

		function addRecipe(recipe){
			//var k = myDataRef.name();
			//console.log(recipe.name+" "+recipe.classification+" "+recipe.details);
			myDataRef.push(recipe);
			//console.log( k );
		}
		

		$("#addFromSideBar").click(function(e) {
			addRecipe(getSideRecipe());
			clearSideBar();
		});



		$("#addFromNavBar").click(function(e) {
			addRecipe(getNavRecipe());
			clearNavBar();
			
		});
	  
	  /*
	  $("#sidebar > li > textarea.recipeDetailsInput").keypress(function (e) {
		if (e.keyCode == 13) {
			addRecipe(getSideRecipe());
			clearSideBar();
		}
	  });
	  
	  $("#navbar > ul > li > textarea.recipeDetailsInput").keypress(function (e) {
		
		if (e.keyCode == 13) {
			addRecipe(getNavRecipe());
			clearSideBar();
		}
	  });
	  */

		function getNavRecipe(){
			var recipe = {
				name : $("#navbar > ul > li > input.recipeNameInput").val(),
				classification : $("#navbar > ul > li > input.recipeClassificationInput").val(),
				details : $("#navbar > ul > li > textarea.recipeDetailsInput").val(),
			};
			return recipe;	  	
		}


		function getSideRecipe(){
			var recipe = {
				name : $("#sidebar > li > input.recipeNameInput").val(),
				classification : $("#sidebar > li > input.recipeClassificationInput").val(),
				details : $("#sidebar > li > textarea.recipeDetailsInput").val()
			};
			return recipe;	  	
		}

		function clearSideBar(){
			$("#sidebar > li > input.recipeNameInput").val("").focus();
			$("#sidebar > li > input.recipeClassificationInput").val("");
			$("#sidebar > li > textarea.recipeDetailsInput").val("");
		}

		function clearNavBar(){
			$("#navbar > ul > li > input.recipeNameInput").val("").focus();
			$("#navbar > ul > li > input.recipeClassificationInput").val("");
			$("#navbar > ul > li > textarea.recipeDetailsInput").val("");
		}

		  
		myDataRef.on("child_added", function(snapshot) {
			var input = snapshot.val();
			
			recipeList.push(input);
			currentPageCount = (parseInt(recipeList.length/recipePerPage)+1);
			
			if(currentPageCount%recipePerPage!=0){
				console.log(currentPageCount+" "+recipeList.length);
				setPagination(currentPageCount);
			}

			recipeDisplayed = $("#recipesDiv > article").length;

			if( recipeDisplayed<=5 ){
				displayRecipeEntry(input.name, 
									input.classification, 
									input.details);
				if( recipeList.length % recipePerPage==0 ){
					setPage(currentPageCount-1);
				}
				else{
					setPage(currentPageCount);
				}
			}
			//console.log(recipeList);
		});


		function backOnePage(){
			var gotopage = parseInt($(".pagination > li.active").text());
			setPage( (gotopage-1) );
		}

		function forwardOnePage(){
			var gotopage = parseInt($(".pagination > li.active").text());
			setPage( (gotopage+1) );
		}

		function setPagination(currentPageCount){
			var content = $("#page-content-wrapper");
			var container = $(".container-fluid");
			var pageContainer = $("#pages").html("");

			var nav = $("<nav/>");
			var ul = $("<ul/>").addClass("pagination");
			

			var pagination = $("#pagination").html("");

			//*
			var p = $("<span/>")
						.attr("aria-hidden", "true")
						.html("&laquo;")
						.click(function(){
							backOnePage();
						});

			var prev = $("<li/>").append(
						$("<a/>")
							.html(p)
							.attr("href", "#")
							.attr("aria-label", "Previous")
						).appendTo(ul);
			//*/
		
			for(i=0; i<currentPageCount; i++){
				var li = $("<li/>").append(
							$("<a/>")
								.html((i+1))
								.attr("href", "#")
								.click(function(){
									setPage( parseInt(this.innerHTML) );
								})
							).appendTo(ul);

				
				
				//$("#page-content-wrapper").append( $("<a/>").html(1).attr("href", "#") )
			}

			//*
			var n = $("<span/>")
						.attr("aria-hidden", "true")
						.html("&raquo;")
						.click(function(){
							forwardOnePage();
						});

			var next = $("<li/>").append(
						$("<a/>")
							.html(n)
							.attr("href", "#")
							.attr("aria-label", "Next")
						).appendTo(ul);
			//*/

			nav.append(ul);
			pageContainer.append(nav);

			//container.append(nav);
			//container.appendTo(content);

		}

		//pagination code modified from CMSC 100 exercise
		function setPage( pageNum ){
			console.log("page "+pageNum);
			if(pageNum<=0 || pageNum>currentPageCount) return;

			$("#recipesDiv").html("");

			var start = ( parseInt( pageNum ) -1 ) * recipePerPage;		
			//console.log(pageNum);

			for(var i=0, j=start; i<recipePerPage && j<recipeList.length; i++, j++){
				//console.log(recipeList.length+" vs "+j);
				displayRecipeEntry(recipeList[j].name, 
									recipeList[j].classification, 
									recipeList[j].details);
				recipeDisplayed = i+1;
			}
			//console.log( parseInt(start/recipePerPage) + 1);
			
			setActivePage(pageNum);
		}

		function setActivePage(page){
			$($("ul.pagination > li")[activePage]).removeClass("active");

			$($("ul.pagination > li")[page]).addClass("active");

			activePage = page;
		}
		//var i=0;
		function displayRecipeEntry(recipeName, recipeClassification, recipeDetails) {
			//console.log(i+1);
			
			var article = $("<article/>")
							.addClass("white-panel")
							.css({
								"word-wrap" : "break-word",
								//"background" : "url('img/left.jpg')",
								//"background-repeat" : "no-repeat",
								//"background-size" : "100% 100%",
							});


			//var rightPad = Math.round($("article.white-panel").width()*0.2);
				//rightPad+="px";
				//console.log('"'+rightPad+'"');

			var wrapper = $("<article/>")
							.addClass("article-wrapper")
							.css({
									"word-wrap" : "break-word",
									//"width" : "auto",
									"padding" : "5%",
									//"padding-right" : Math.round($("article.white-panel").width()*0.255)+"px"
								});


			wrapper.append(	//title
						$("<strong/>")
							.html(recipeName)
							.css({
								"display" : "block",
								"margin-bottom" : "10px",
								"word-wrap" : "break-word"
							})
					);
			wrapper.append(	//classification
						$("<span/>")
							.html("(<em>"+recipeClassification+"</em>)")
							.css({"word-wrap" : "break-word"})
					);
			wrapper.append(	//details
						$("<p/>")
							.text(recipeDetails)
							.css({
								"margin-top" : "10px",
								"margin-bottom" : "10px",
								"word-wrap" : "break-word",
							})
					);
			
			wrapper.appendTo(article);


			//var w = ;
				//width+="px";
			//var h = $("article.white-panel").height();
				//height+="px";

			article.appendTo($("#recipesDiv"));



			//alert(recipeName+" "+recipeClassification+" "+recipeDetails);
			//console.log(recipeName+" "+recipeClassification+" "+recipeDetails);
			$("#recipesDiv")[0].scrollTop = $("#recipesDiv")[0].scrollHeight;
		};

		//*
		$(document).ready(function(){
			for(i=0; i<recipe.length; i++ )recipeList.push(recipe[i]);
			currentPageCount = (parseInt(recipeList.length/recipePerPage)+1);
			setPagination(currentPageCount);

			for(j=0; j<recipePerPage; j++){
				displayRecipeEntry(recipe[j].name, recipe[j].classification, recipe[j].details);
			}

			setActivePage(1);
		});
		//*/

	</script>

</body>

</html>
